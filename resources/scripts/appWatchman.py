###################################################################################
#                                                                                 #
# app_watchman.py                                                                 #
#                                                                                 #
###################################################################################
#                                                                                 #
#    Scorpion Anti-malware is a free Open Source AI-powered Anti-malware          #
#    framework for Researchers.                                                   #
#                                                                                 #
#    Copyright (c) 2024-present  (see AUTHORS.md).                                #
#                                                                                 #
#    This program is free software: you can redistribute it and/or modify         #
#    it under the terms of the GNU General Public License as published by         #
#    the Free Software Foundation, either version 3 of the License, or            #
#    (at your option) any later version.                                          #
#                                                                                 #
#    This program is distributed in the hope that it will be useful,              #
#    but WITHOUT ANY WARRANTY; without even the implied warranty of               #
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                #
#    GNU General Public License for more details.                                 #
#                                                                                 #
#    You should have received a copy of the GNU General Public License            #
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.       #
#                                                                                 #
###################################################################################


import winreg

def get_installed_applications():
    applications = []
    # Open the Uninstall registry key where most applications register themselves
    uninstall_key = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, "Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall")
    
    # Function to get the display name of an application from its registry key
    def get_display_name(sub_key):
        try:
            display_name, _ = winreg.QueryValueEx(sub_key, "DisplayName")
            return display_name
        except FileNotFoundError:
            return None
    
    # Iterate through all subkeys to get application information
    for i in range(winreg.QueryInfoKey(uninstall_key)[0]):
        sub_key_name = winreg.EnumKey(uninstall_key, i)
        sub_key = winreg.OpenKey(uninstall_key, sub_key_name)
        display_name = get_display_name(sub_key)
        if display_name:
            applications.append(display_name)

    return applications

if __name__ == "__main__":
    print("Installed Applications:")
    installed_applications = get_installed_applications()
    for app in installed_applications:
        print(app)
