from glob import glob
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options
import time

def read_list_from_file(filename):

    with open(filename, 'r') as file:
        string_list = [line.strip() for line in file]
    return string_list


# Example usage:
path_to_save = 'C:/Users/abdoa/Downloads/malwares/ids.txt'
ids_list = read_list_from_file(path_to_save)

chrome_options = Options()
chrome_options.add_argument("--window-size=1920,1080")
chrome_options.add_experimental_option("prefs", {"safebrowsing.enabled": True})

driver = webdriver.Chrome(options=chrome_options)


while ids_list:
    
    driver.get(f'https://cuckoo.cert.ee/analysis/{ids_list[0]}/export/')
    if driver.find_elements(By.CLASS_NAME, 'app-error__header'):
        ## Not done
        time.sleep(60)
    else:
        ## Reported
        buttons = driver.find_elements(By.CLASS_NAME, 'cuckoo-box-primary')
        for button in buttons:
            if not button.text.split(' ')[0] == 'reports':
                button.click()
            time.sleep(0.2)

        driver.find_element(By.XPATH, '//*[@id="options"]/div/div[3]/div[2]/button').click()
        ids_list.pop(0)
        time.sleep(4)


time.sleep(300)
        