###################################################################################
#                                                                                 #
# services_watcher.py                                                             #
#                                                                                 #
###################################################################################
#                                                                                 #
#    Scorpion Anti-malware is a free Open Source AI-powered Anti-malware          #
#    framework for Researchers.                                                   #
#                                                                                 #
#    Copyright (c) 2024-present  (see AUTHORS.md).                                #
#                                                                                 #
#    This program is free software: you can redistribute it and/or modify         #
#    it under the terms of the GNU General Public License as published by         #
#    the Free Software Foundation, either version 3 of the License, or            #
#    (at your option) any later version.                                          #
#                                                                                 #
#    This program is distributed in the hope that it will be useful,              #
#    but WITHOUT ANY WARRANTY; without even the implied warranty of               #
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                #
#    GNU General Public License for more details.                                 #
#                                                                                 #
#    You should have received a copy of the GNU General Public License            #
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.       #
#                                                                                 #
###################################################################################


import win32service
import time


def print_running_services():
    while True:
        # Open the SCM database
        scm_manager = win32service.OpenSCManager(None, None, win32service.SC_MANAGER_ENUMERATE_SERVICE)

        # Get list of all running services
        running_services = win32service.EnumServicesStatus(scm_manager, win32service.SERVICE_WIN32, win32service.SERVICE_STATE_ALL)

        print("Running Services:")
        for service in running_services:
            # Print service name and display name
            service_name = service[0]
            service_display_name = service[1]
            print(f"Service Name: {service_name}, Display Name: {service_display_name}")

        print("---------------------------------------------")
        win32service.CloseServiceHandle(scm_manager)
        time.sleep(5)  # Sleep for 5 seconds before checking again


if __name__ == "__main__":
    print_running_services()
