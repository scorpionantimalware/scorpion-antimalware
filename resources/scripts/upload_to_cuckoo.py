from glob import glob
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options
import time

def from_list_to_txt(string_list, filename):
    try:
        with open(filename, 'w') as file:
            for item in string_list:
                file.write(item + '\n')
    except Exception as e:
        print(f"An error occurred: {e}")

to_upload_paths = glob('C:/Users/abdoa/Downloads/malwares/*.exe')
path_to_save = 'C:/Users/abdoa/Downloads/malwares/ids.txt'
chrome_options = Options()
chrome_options.add_argument("--window-size=1920,1080")
chrome_options.add_experimental_option("prefs", {"safebrowsing.enabled": True})

driver = webdriver.Chrome(options=chrome_options)
ids_list = []
for exe_file_path in to_upload_paths:
    
    driver.get('https://cuckoo.cert.ee/submit/')
    driver.implicitly_wait(60)

    time.sleep(2)
    file_input = driver.find_element(By.ID, 'file')

    # Upload the file by sending the file path to the file input element
    file_input.send_keys(exe_file_path)
    time.sleep(2)
    driver.find_element(By.XPATH, '//*[@id="timeout"]/ul/li[1]').click() ## TimeOut 60
    time.sleep(0.5)
    driver.find_element(By.XPATH, '//*[@id="options"]/ul/li[3]/label/span').click() ## Process Memory Dump
    time.sleep(0.5)
    driver.find_element(By.XPATH, '//*[@id="options"]/ul/li[4]/label/span').click() ## Full Memory Dump
    time.sleep(0.5)
    driver.find_element(By.XPATH, '//*[@id="start-analysis"]').click() ## Analysis
    time.sleep(2)
    
    task_id = driver.find_element(By.XPATH, '//*[@id="submission-task-table"]/tbody').text.split(' ')[0]
    ids_list.append(task_id)
    
    # Wait a bit to ensure the file upload completes
    time.sleep(2)
driver.quit()
from_list_to_txt(ids_list, path_to_save)