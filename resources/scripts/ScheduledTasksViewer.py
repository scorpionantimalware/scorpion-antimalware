###################################################################################
#                                                                                 #
# scheduled_tasks_viewer.py                                                       #
#                                                                                 #
###################################################################################
#                                                                                 #
#    Scorpion Anti-malware is a free Open Source AI-powered Anti-malware          #
#    framework for Researchers.                                                   #
#                                                                                 #
#    Copyright (c) 2024-present  (see AUTHORS.md).                                #
#                                                                                 #
#    This program is free software: you can redistribute it and/or modify         #
#    it under the terms of the GNU General Public License as published by         #
#    the Free Software Foundation, either version 3 of the License, or            #
#    (at your option) any later version.                                          #
#                                                                                 #
#    This program is distributed in the hope that it will be useful,              #
#    but WITHOUT ANY WARRANTY; without even the implied warranty of               #
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                #
#    GNU General Public License for more details.                                 #
#                                                                                 #
#    You should have received a copy of the GNU General Public License            #
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.       #
#                                                                                 #
###################################################################################


import subprocess

def get_scheduled_tasks():
    # Run the schtasks command to get information about all scheduled tasks
    result = subprocess.run(["schtasks", "/query", "/fo", "csv"], capture_output=True, text=True)

    # Check if the command was successful
    if result.returncode == 0:
        # Split the output by lines and skip the first two lines (header and delimiter)
        lines = result.stdout.strip().split('\n')[2:]
        # Extract task names from the output
        tasks = [line.split(',')[0].strip('"') for line in lines]
        return tasks
    else:
        print("Failed to retrieve scheduled tasks.")
        return []

if __name__ == "__main__":
    print("Scheduled Tasks:")
    scheduled_tasks = get_scheduled_tasks()
    for task in scheduled_tasks:
        print(task)
