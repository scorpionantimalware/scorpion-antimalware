#ifndef PE_ENGINE_H
#define PE_ENGINE_H

// It is recommended to always define PY_SSIZE_T_CLEAN before including Python.h. See https://docs.python.org/3/c-api/arg.html#arg-parsing for a description of this macro.
#define PY_SSIZE_T_CLEAN

// Since Python may define some pre-processor definitions which affect the standard headers on some systems, you must include Python.h before any standard headers are included.
#include <Python.h>

#include <string>

/**
 * @brief The directory containing the Python module
*/
#ifndef PE_ENGINE_SCRIPTS_DIR
#error "PE_ENGINE_SCRIPTS_DIR is not defined"
#endif

// Define a struct to hold the result and its size
struct FeaturesArray {
    double* features;
    size_t size;
};

class PEEngine {
 public:
  PEEngine();
  ~PEEngine();

  /**
   * @brief Get the PE features of a file
   * 
   * @note The number of features returned is 2381.
   * 
   * @param filepath The path to the file
   * 
   * @return The PE features of the file
  */
  FeaturesArray get_pe_features(std::string& filepath);

  private:
  PyObject* pModule;
  PyObject* pFunc;
}; // class PEEngine

#endif // PE_ENGINE_H
