# Caching the library name to be used in the parent scope.
set(SAM_ENGINE "sam_engine" CACHE STRING "SAM Engine library name.")

file(GLOB SAM_ENGINE_SRC_FILES 
    ${CMAKE_CURRENT_SOURCE_DIR}/samengine.h
    ${CMAKE_CURRENT_SOURCE_DIR}/samengine.cpp
)

# Check https://cmake.org/cmake/help/latest/module/FindPython.html for more information.
# TODO: We can use an older version of Python.
find_package(Python 3.10 REQUIRED COMPONENTS Interpreter Development NumPy)

add_library(${SAM_ENGINE} SHARED 
    ${SAM_ENGINE_SRC_FILES} 
)

set_target_properties(${SAM_ENGINE} PROPERTIES VERSION ${SAM_PROJECT_VERSION})

add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/byte-pixel-engine/)
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/PE-engine/)
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/sam-parser/)

target_link_libraries(${SAM_ENGINE} PUBLIC 
    ${BYTE_PIXEL_ENGINE} 
    ${PE_ENGINE} 
    ${SAM_PARSER} 
)

# When we use any header inside ${SAM_ENGINE}, it must know where these headers are.
target_include_directories(${SAM_ENGINE} PUBLIC 
    "${CMAKE_CURRENT_SOURCE_DIR}/" 
    "${CMAKE_CURRENT_SOURCE_DIR}/byte-pixel-engine/" 
    "${CMAKE_CURRENT_SOURCE_DIR}/PE-engine/" 
    "${CMAKE_CURRENT_SOURCE_DIR}/sam-parser/" 
    "${Python_INCLUDE_DIRS}/" 
)
