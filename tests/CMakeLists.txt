# Caching the library name to be used in the parent scope.
set(SAM_ENGINE_TESTS "sam_engine_tests" CACHE STRING "SAM Engine tests library name.")

file(GLOB SAM_ENGINE_TESTS_SRC_FILES 
    ${CMAKE_CURRENT_SOURCE_DIR}/testsmain.h
    ${CMAKE_CURRENT_SOURCE_DIR}/testsmain.cpp
)

# TODO: Is this needed?
enable_testing()

# Check https://cmake.org/cmake/help/latest/module/FindGTest.html for more information.
find_package(GTest REQUIRED)

add_executable(${SAM_ENGINE_TESTS} ${SAM_ENGINE_TESTS_SRC_FILES})

set_target_properties(${SAM_ENGINE_TESTS} PROPERTIES VERSION ${SAM_PROJECT_VERSION})

# You can use ${GTEST_BOTH_LIBRARIES} which contains both gtest and gtest_main instead of ${GTEST_LIBRARIES} and ${GTEST_MAIN_LIBRARIES}.
target_link_libraries(${SAM_ENGINE_TESTS} PUBLIC 
    ${SAM_ENGINE} 
    ${GTEST_LIBRARIES}
    ${GTEST_MAIN_LIBRARIES}
)

# When we use any header inside ${SAM_ENGINE_TESTS}, it must know where these headers are.
target_include_directories(${SAM_ENGINE_TESTS} PUBLIC 
    "${CMAKE_CURRENT_SOURCE_DIR}/" 
    "${GTEST_INCLUDE_DIRS}/" 
)

add_test(NAME ${SAM_ENGINE_TESTS} COMMAND ${SAM_ENGINE_TESTS})
